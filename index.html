<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ðŸ”¥ Calisthenics RPG Tracker â€“ 20 Levels</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
body{
    background:#111 url('ronaldo.jpg') no-repeat center center fixed;
    background-size: cover;
    color:#fff;
    min-height:100vh;
}
header{text-align:center;padding:20px;background: rgba(0,0,0,0.7);}
h1{font-size:2.5rem;margin-bottom:5px;text-shadow:0 0 10px #00ff99;}
.container{max-width:1400px;margin:20px auto;padding:0 20px;}
.week-card{background: rgba(0,0,0,0.7); padding:15px; border-radius:15px; margin-bottom:25px; box-shadow:0 8px 25px rgba(0,0,0,0.6); transition: transform 0.3s, box-shadow 0.3s;}
.week-card:hover{transform:translateY(-5px); box-shadow:0 12px 30px rgba(0,255,153,0.7);}
.day-card{background:rgba(255,255,255,0.1); padding:10px; border-radius:10px; margin-bottom:10px; position:relative; overflow:hidden;}
.day-card::before{content:""; position:absolute; top:0; left:0; width:100%; height:100%; background:url('ronaldo.jpg') center center/cover no-repeat; opacity:0.1; z-index:0;}
.exercise{display:flex; align-items:center; margin:5px 0; padding:5px 10px; background: rgba(255,255,255,0.05); border-radius:5px; cursor:pointer; transition: 0.3s; position: relative; z-index:1;}
.exercise.completed{background:#00ff99; color:#000; font-weight:700; text-decoration: line-through;}
.exercise:hover{transform:scale(1.03);}
#xp-bar-container{background:rgba(255,255,255,0.2); border-radius:10px; overflow:hidden; margin-top:10px;}
#xp-bar{height:20px; background:#00ff99; width:0%; transition:width 0.5s;}
.level-progress{margin:20px 0;padding:15px;background: rgba(0,0,0,0.6);border-radius:15px;}
button{padding:10px 20px; border:none; border-radius:5px; cursor:pointer; background:#00ff99; color:#000; margin:10px 0; font-weight:bold; box-shadow:0 4px 10px rgba(0,255,153,0.5);}
canvas{border:2px solid #00ff99; margin-top:10px; border-radius:10px;}
svg{max-width:100%; overflow-x:auto;}
#photo-input{display:block;margin:15px 0;}
</style>
</head>
<body>
<header>
<h1>ðŸ”¥ Calisthenics RPG Tracker</h1>
<p>Complete exercises â†’ Upload progress photo â†’ Unlock next level!</p>
</header>
<div class="container">
<h2>Level: <span id="current-level">1</span></h2>
<div id="xp-bar-container"><div id="xp-bar"></div></div>
<div>Total XP: <span id="xp-display">0</span></div>
<div id="weeks-container"></div>

<h2>Skill Tree</h2>
<svg id="skill-tree-svg" width="1400" height="150"></svg>

<h2>Level Progress Check</h2>
<div id="progress-check-container"></div>

<input type="file" accept="image/*" id="photo-input">
<canvas id="photo-canvas" width="300" height="300"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.11.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix"></script>
<script>
// ----------------- FULL 20-LEVEL ROADMAP MONâ†’SUN -----------------
const roadmap = {};
for(let i=1;i<=20;i++){
    roadmap[i] = {title: i<=8 ? `Foundation Level ${i}` : `Skill Phase Level ${i}`, weekRange: `Week ${i}`, days:{
        Mon:[`Push-ups ${i}x10`, `Squats ${i}x15`, `Plank ${i}x15s`, `Pull exercise ${i}x5`],
        Tue:[`Hollow Hold ${i}x15s`, `Side Plank ${i}x10s`, `Pull-ups ${i}x5`],
        Wed:[`Step-ups ${i}x10`, `Romanian Deadlift ${i}x10`, `Calf Raises ${i}x15`],
        Thu:[`Cardio 15â€“20min`, `Dynamic stretches`],
        Fri:[`Push-ups ${i}x12`, `Dips ${i}x8`, `Core exercise ${i}x10`],
        Sat:[`Archer Squats ${i}x10`, `Glute Bridges ${i}x12`, `Wall sits ${i}x30s`],
        Sun:['Rest']
    }};
}

// ----------------- STATE -----------------
let xp = parseInt(localStorage.getItem('xp')) || 0;
let currentLevel = parseInt(localStorage.getItem('currentLevel')) || 1;

// ----------------- FUNCTIONS -----------------
function renderWeeks(){
    const container = document.getElementById('weeks-container');
    container.innerHTML='';
    for(let lvl=1; lvl<=currentLevel; lvl++){
        const week = roadmap[lvl];
        if(!week) continue;
        const card = document.createElement('div'); card.className='week-card';
        let html=`<h3>${week.title} (${week.weekRange})</h3>`;
        for(let day in week.days){
            html+=`<div class="day-card"><strong>${day}</strong>`;
            week.days[day].forEach((ex,idx)=>{
                const key = `lvl${lvl}-day${day}-ex${idx}`;
                const done = JSON.parse(localStorage.getItem(key))||false;
                html+=`<div class="exercise ${done?'completed':''}" data-key="${key}">${ex}</div>`;
            });
            html+=`</div>`;
        }
        card.innerHTML=html; container.appendChild(card);
    }
    document.querySelectorAll('.exercise').forEach(el=>{
        el.addEventListener('click', ()=>{
            const key = el.getAttribute('data-key');
            let done = JSON.parse(localStorage.getItem(key))||false;
            done = !done;
            localStorage.setItem(key,JSON.stringify(done));
            el.classList.toggle('completed');
            if(done){ xp+=10; } else { xp=Math.max(xp-10,0); }
            localStorage.setItem('xp',xp);
            document.getElementById('xp-display').innerText=xp;
            document.getElementById('xp-bar').style.width=`${Math.min(xp,100)}%`;
        });
    });
}

// Skill tree visualization
function renderSkillTree(){
    const svg = document.getElementById('skill-tree-svg');
    svg.innerHTML='';
    for(let i=1;i<=20;i++){
        const x = 50 + (i-1)*65;
        const circle = document.createElementNS("http://www.w3.org/2000/svg","circle");
        circle.setAttribute("cx",x); circle.setAttribute("cy",75); circle.setAttribute("r",20);
        circle.setAttribute("fill", i<=currentLevel?"#00ff99":"#444");
        svg.appendChild(circle);
        const text = document.createElementNS("http://www.w3.org/2000/svg","text");
        text.setAttribute("x",x); text.setAttribute("y",75); text.setAttribute("text-anchor","middle"); text.setAttribute("dy",5);
        text.setAttribute("fill","#000"); text.setAttribute("font-size","10px"); text.textContent=i;
        svg.appendChild(text);
        if(i>1){
            const line = document.createElementNS("http://www.w3.org/2000/svg","line");
            line.setAttribute("x1",x-65); line.setAttribute("y1",75);
            line.setAttribute("x2",x); line.setAttribute("y2",75);
            line.setAttribute("stroke", "#00ff99"); line.setAttribute("stroke-width",2);
            svg.appendChild(line);
        }
    }
}

// Progress photo AI tracker
async function checkProgressPhoto(file){
    const canvas = document.getElementById('photo-canvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.src = URL.createObjectURL(file);
    await img.decode();
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
    const net = await bodyPix.load();
    const segmentation = await net.segmentPerson(canvas);
    const mask = bodyPix.toMask(segmentation);
    ctx.putImageData(mask,0,0);
    const data = mask.data; let count=0;
    for(let i=0;i<data.length;i+=4){ if(data[i+3]>128) count++; }
    const percent = (count/(canvas.width*canvas.height))*100;
    if(percent>10){
        alert('AI Tracker: Progress detected! Level Up!');
        if(currentLevel<20){ currentLevel++; localStorage.setItem('currentLevel',currentLevel); document.getElementById('current-level').innerText=currentLevel; renderWeeks(); renderSkillTree(); }
    } else { alert('AI Tracker: No significant progress. Repeat level.'); }
}

document.getElementById('photo-input').addEventListener('change', e=>{
    checkProgressPhoto(e.target.files[0]);
});

// Manual Progress Check
function renderProgressCheck(){
    const container=document.getElementById('progress-check-container');
    container.innerHTML='';
    const btn = document.createElement('button');
    btn.innerText='Simulated Level Check';
    btn.onclick=()=>{
        const success = Math.random()>=0.5;
        if(success){
            if(currentLevel<20){ currentLevel++; localStorage.setItem('currentLevel',currentLevel); document.getElementById('current-level').innerText=currentLevel; renderWeeks(); renderSkillTree(); }
            alert('Progress Confirmed! Level Up!');
        } else{ alert('Insufficient Progress. Repeat Level.'); }
    }
    container.appendChild(btn);
    // --- Reset Total XP Button ---
function renderXPReset(){
    const container = document.getElementById('progress-check-container');
    const btn = document.createElement('button');
    btn.innerText = 'Reset Total XP';
    btn.style.background = '#ff4d4d';
    btn.style.color = '#fff';
    btn.onclick = () => {
        xp = 0;
        localStorage.setItem('xp', xp);
        document.getElementById('xp-display').innerText = xp;
        document.getElementById('xp-bar').style.width = '0%';
        alert('Total XP has been reset to 0!');
    };
    container.appendChild(btn);
}

// Call after rendering progress check
renderXPReset();

}

// ----------------- INITIAL RENDER -----------------
document.getElementById('current-level').innerText=currentLevel;
document.getElementById('xp-display').innerText=xp;
renderWeeks();
renderSkillTree();
renderProgressCheck();
</script>
</body>
</html>
