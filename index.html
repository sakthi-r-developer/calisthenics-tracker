<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî• Calisthenics RPG Tracker</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif;}
body{
    background:#111 url('ronaldo.jpg') no-repeat center center fixed;
    background-size: cover;
    color:#fff;
    min-height:100vh;
}
header{
    text-align:center;
    padding:20px;
    background: rgba(0,0,0,0.7);
}
h1{font-size:2.5rem;margin-bottom:5px;text-shadow:0 0 10px #00ff99;}
.container{max-width:1200px;margin:20px auto;padding:0 20px;}
.week-card{
    background: rgba(0,0,0,0.7);
    padding:15px;
    border-radius:15px;
    margin-bottom:25px;
    box-shadow:0 8px 25px rgba(0,0,0,0.6);
    transition: transform 0.3s, box-shadow 0.3s;
}
.week-card:hover{
    transform:translateY(-5px);
    box-shadow:0 12px 30px rgba(0,255,153,0.7);
}
.day-card{
    background:rgba(255,255,255,0.1);
    padding:10px;
    border-radius:10px;
    margin-bottom:10px;
    position:relative;
    overflow:hidden;
}
.day-card::before{
    content:"";
    position:absolute;
    top:0;left:0;width:100%;height:100%;
    background:url('ronaldo.jpg') center center/cover no-repeat;
    opacity:0.1;
    z-index:0;
}
.exercise{
    display:flex;
    align-items:center;
    margin:5px 0;
    padding:5px 10px;
    background: rgba(255,255,255,0.05);
    border-radius:5px;
    cursor:pointer;
    transition: 0.3s;
    position: relative;
    z-index:1;
}
.exercise.completed{
    background:#00ff99;
    color:#000;
    font-weight:700;
    text-decoration: line-through;
}
.exercise:hover{
    transform:scale(1.03);
}
#xp-bar-container{
    background:rgba(255,255,255,0.2);
    border-radius:10px;
    overflow:hidden;
    margin-top:10px;
}
#xp-bar{
    height:20px;
    background:#00ff99;
    width:0%;
    transition:width 0.5s;
}
.skill-tree{
    display:flex;
    flex-wrap:wrap;
    gap:20px;
    justify-content:center;
    margin-top:30px;
    position: relative;
}
.skill{
    padding:15px 25px;
    border-radius:50px;
    background:rgba(255,255,255,0.2);
    cursor:pointer;
    transition:0.3s;
    position: relative;
}
.skill.unlocked{
    background:#00ff99;
    color:#000;
    font-weight:700;
}
button{
    padding:10px 20px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    background:#00ff99;
    color:#000;
    margin:10px 0;
    font-weight:bold;
    box-shadow:0 4px 10px rgba(0,255,153,0.5);
}
canvas{border:2px solid #00ff99;margin-top:10px;border-radius:10px;}
.level-progress{margin:20px 0;padding:15px;background: rgba(0,0,0,0.6);border-radius:15px;}
</style>
</head>
<body>
<header>
<h1>üî• Calisthenics RPG Tracker</h1>
<p>Complete exercises ‚Üí Upload progress photo ‚Üí Unlock next level!</p>
</header>
<div class="container">
<h2>Level: <span id="current-level">1</span></h2>
<div id="xp-bar-container"><div id="xp-bar"></div></div>
<div>Total XP: <span id="xp-display">0</span></div>

<div id="weeks-container"></div>

<h2>Skill Tree</h2>
<div class="skill-tree" id="skill-tree"></div>

<h2>Level Progress Check</h2>
<div id="progress-check-container"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>

<script>
// ----------------- ROADMAP -----------------
const roadmap = {};
for(let i=1;i<=20;i++){
    const phase = i<=8 ? 'Foundation Phase' : 'Skill Phase';
    roadmap[i] = {
        title: `${phase} Level ${i}`,
        weekRange: `Week ${i}`,
        days:{
            Mon:[`Push-ups ${i}x${i+7}`],
            Tue:[`Squats ${i}x${i+10}`],
            Wed:[i>=9 ? `Skill practice for Level ${i}`:`Dips ${i}x${i+5}`],
            Thu:['Flexibility & Mobility'],
            Fri:[`Core hold ${i}x${i*5}s`],
            Sat:['Extra Core/Accessory'],
            Sun:['Rest']
        }
    };
}

// ----------------- SKILLS -----------------
const skills = ['Crow Pose','Pike Push-ups','L-sit','Archer Push-ups','Skin the Cat','Handstand','Pistol Squat','Toes-to-Bar','Front Lever','One-Arm Push-up','Back Lever','Muscle-Up'];

// ----------------- STATE -----------------
let xp = parseInt(localStorage.getItem('xp')) || 0;
let currentLevel = parseInt(localStorage.getItem('currentLevel')) || 1;

// ----------------- RENDER FUNCTIONS -----------------
function renderWeeks(){
    const container = document.getElementById('weeks-container');
    container.innerHTML='';
    for(let lvl=1; lvl<=currentLevel; lvl++){
        const week = roadmap[lvl];
        const card = document.createElement('div'); card.className='week-card';
        let html=`<h3>${week.title} (${week.weekRange})</h3>`;
        for(let day in week.days){
            html+=`<div class="day-card"><strong>${day}</strong>`;
            week.days[day].forEach((ex,idx)=>{
                const key = `lvl${lvl}-day${day}-ex${idx}`;
                const done = JSON.parse(localStorage.getItem(key))||false;
                html+=`<div class="exercise ${done?'completed':''}" onclick="toggleExercise('${key}',this)">${ex}</div>`;
            });
            html+='</div>';
        }
        card.innerHTML=html;
        container.appendChild(card);
    }
    updateXPBar();
}

function toggleExercise(key,el){
    const completed = el.classList.toggle('completed');
    localStorage.setItem(key,completed);
    xp += completed ? 10 : -10;
    localStorage.setItem('xp',xp);
    document.getElementById('xp-display').innerText=xp;
    updateXPBar();
}

function updateXPBar(){
    const bar = document.getElementById('xp-bar');
    let percent = Math.min(xp, currentLevel*120)/(currentLevel*120)*100;
    bar.style.width = percent+'%';
}

function renderSkills(){
    const tree = document.getElementById('skill-tree');
    tree.innerHTML='';
    skills.forEach((s,i)=>{
        const div = document.createElement('div'); div.className='skill';
        if(currentLevel>=i+9) div.classList.add('unlocked');
        div.innerText=s;
        tree.appendChild(div);
    });
}

// ----------------- LEVEL UP -----------------
function levelUp(){
    if(currentLevel<20) currentLevel++;
    localStorage.setItem('currentLevel',currentLevel);
    document.getElementById('current-level').innerText=currentLevel;
    renderWeeks();
    renderSkills();
    renderProgressCheck();
}

// ----------------- LEVEL PROGRESS CHECK -----------------
function renderProgressCheck(){
    const container = document.getElementById('progress-check-container');
    container.innerHTML='';
    const lvlDiv = document.createElement('div'); lvlDiv.className='level-progress';
    lvlDiv.innerHTML=`
        <h3>Level ${currentLevel} Progress Upload</h3>
        <input type="file" accept="image/*" id="level-upload">
        <canvas id="level-canvas" width="300" height="300"></canvas>
        <div id="level-analysis"></div>
        <button onclick="checkProgress(${currentLevel})">Submit Progress</button>
        <div id="level-history"></div>
    `;
    container.appendChild(lvlDiv);

    // Load previous images
    const historyDiv = document.getElementById('level-history');
    const history = JSON.parse(localStorage.getItem(`level${currentLevel}-photos`)||'[]');
    history.forEach(src=>{
        const img = new Image(); img.src=src; img.width=100; img.style.margin='5px';
        historyDiv.appendChild(img);
    });
}

async function checkProgress(level){
    const input = document.getElementById('level-upload').files[0];
    if(!input) return alert('Upload a photo first!');

    const img = new Image();
    img.src = URL.createObjectURL(input);
    img.onload = async ()=>{
        const canvas = document.getElementById('level-canvas');
        canvas.width = img.width; canvas.height = img.height;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img,0,0);

        const net = await bodyPix.load();
        const segmentation = await net.segmentPerson(img);
        bodyPix.drawMask(canvas,img,segmentation,0.7,0,false);

        const personPixels = segmentation.data.filter(p=>p===1).length;
        document.getElementById('level-analysis').innerText = `Body coverage: ${personPixels}px`;

        // Threshold can be adjusted per level
        const threshold = 10000 + (level-1)*500;
        // Save photo history
        const reader = new FileReader();
        reader.onload = ()=>{
            const photos = JSON.parse(localStorage.getItem(`level${level}-photos`)||'[]');
            photos.push(reader.result);
            localStorage.setItem(`level${level}-photos`,JSON.stringify(photos));
            renderProgressCheck();
        };
        reader.readAsDataURL(input);

        if(personPixels>=threshold){
            alert('‚úÖ Progress sufficient! Level Complete!');
            levelUp();
        } else {
            alert('‚ö†Ô∏è Not enough progress. Repeat this level.');
        }
    }
}

// ----------------- INITIAL RENDER -----------------
document.getElementById('current-level').innerText=currentLevel;
document.getElementById('xp-display').innerText=xp;
renderWeeks();
renderSkills();
renderProgressCheck();
</script>
</body>
</html>
